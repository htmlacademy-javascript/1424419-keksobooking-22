(()=>{"use strict";var e={d:(t,r)=>{for(var o in r)e.o(r,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:r[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{x:()=>Z});const t={flat:"Квартира",bungalow:"Бунгало",house:"Дом",palace:"Дворец "},r=document.querySelector("#card").content.querySelector(".popup"),o=()=>{const e=document.createElement("div");e.style.zIndex=100,e.style.position="fixed",e.style.left=0,e.style.top=0,e.style.right=0,e.style.padding="10px 3px",e.style.fontSize="35px",e.style.textAlign="center",e.style.backgroundColor="#ff4040",e.textContent="Ошибка загрузки данных. Попробуйте ещё раз",document.body.append(e),setTimeout((()=>{e.remove()}),3500)},n="any",a=document.querySelector(".map__filters"),c=a.querySelectorAll("select"),l=a.querySelector("#housing-features"),s=a.querySelector("#housing-type"),i=a.querySelector("#housing-price"),d=a.querySelector("#housing-rooms"),u=a.querySelector("#housing-guests"),p=({offer:e})=>{return r=e.type,(s.value===n||s.value===r)&&(e=>d.value===n||Number(d.value)===e)(e.rooms)&&(t=e.guests,u.value===n||Number(u.value)===t)&&(e=>{switch(i.value){case n:return!0;case"middle":return e>=1e4&&e<=5e4;case"low":return e<1e4;case"high":return e>=5e4}})(e.price)&&(e=>{const t=l.querySelectorAll("input:checked");return Array.from(t).every((t=>e.includes(t.value)))})(e.features);var t,r};(()=>{a.classList.add("map__filters--disabled"),l.disabled=!0;for(let e of c)e.disabled=!0})();const y=["gif","jpg","jpeg","png"],m="img/muffin-grey.svg",g=document.querySelector(".ad-form-header__input"),h=document.querySelector(".ad-form-header__preview img"),f=document.querySelector(".ad-form__input"),v=document.querySelector(".ad-form__photo"),S=(e,t)=>{e.addEventListener("change",(()=>{const r=e.files[0],o=r.name.toLowerCase();if(y.some((e=>o.endsWith(e)))){const e=new FileReader;e.addEventListener("load",(()=>{t.src=e.result})),e.readAsDataURL(r)}}))};S(g,h);const q=document.createElement("img");q.width=40,q.height=44,q.alt="Фотография жилья",q.src=m,v.style.display="flex",v.style.justifyContent="center",v.style.alignItems="center",v.appendChild(q),S(f,q);const b=document.querySelector("main"),E=document.querySelector("#success").content.querySelector(".success"),x=document.querySelector("#error").content.querySelector(".error").cloneNode(!0),k=x.querySelector(".error__button"),w=e=>{"Escape"!==e.key&&"Esc"!==e.key||(e.preventDefault(),C())},C=()=>{b.contains(E)&&b.removeChild(E),b.contains(x)&&b.removeChild(x),document.removeEventListener("keydown",w)};k.addEventListener("click",C),b.addEventListener("click",C);const A={bungalow:0,flat:1e3,house:5e3,palace:1e4},$={1:["1"],2:["1","2"],3:["1","2","3"],100:["0"]},j=document.querySelector(".ad-form"),T=j.querySelector("#type"),z=j.querySelector("#price"),D=j.querySelector("#timein"),M=j.querySelector("#timeout"),O=j.querySelectorAll("fieldset"),F=j.querySelector("#address"),H=j.querySelector("#room_number"),N=j.querySelector("#capacity"),P=j.querySelector(".ad-form__reset");(()=>{j.classList.add("ad-form--disabled");for(let e of O)e.disabled=!0})();const U=()=>{z.placeholder=A[T.value],z.min=A[T.value]};T.addEventListener("change",U);const I=e=>{const t=N.querySelectorAll("option");t.forEach((e=>{e.disabled=!0})),$[e].forEach((e=>{t.forEach((t=>{t.value===e&&(t.disabled=!1,t.selected=!0)}))}))};H.addEventListener("change",(()=>{I(H.value)})),N.addEventListener("focus",(()=>{I(H.value)}));const R=()=>{j.reset(),a.reset(),Z(),h.src=m,q.src=m};var V;P.addEventListener("click",(e=>{e.preventDefault(),R()})),V=R,j.addEventListener("submit",(e=>{e.preventDefault(),((e,t,r)=>{fetch("https://22.javascript.pages.academy/keksobooking",{method:"POST",body:r}).then((r=>{r.ok?e():t()})).catch((()=>{t()}))})((()=>V((b.appendChild(E),void document.addEventListener("click",w)))),(()=>(b.appendChild(x),void document.addEventListener("click",w))),new FormData(e.target))}));const W={lat:35.65841,lng:139.78145},B=()=>{F.value=`${W.lat}, ${W.lng}`},G=L.map("map-canvas").on("load",(()=>{(()=>{a.classList.remove("map__filters--disabled"),l.disabled=!1;for(let e of c)e.disabled=!1})(),(()=>{j.classList.remove("ad-form--disabled");for(let e of O)e.disabled=!1})(),U(),D.addEventListener("change",(()=>M.value=D.value)),M.addEventListener("change",(()=>D.value=M.value)),B()})).setView({lat:W.lat,lng:W.lng},12);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(G);const J=L.icon({iconUrl:"./img/main-pin.svg",iconSize:[40,40],iconAnchor:[20,40]}),K=L.marker({lat:W.lat,lng:W.lng},{draggable:!0,icon:J});K.addTo(G),K.on("moveend",(e=>{F.value=`${e.target.getLatLng().lat.toFixed(5)}, ${e.target.getLatLng().lng.toFixed(5)}`}));const Q=L.icon({iconUrl:"./img/pin.svg",iconSize:[40,40],iconAnchor:[20,40]});let X=[];const Y=e=>{e.slice().filter(p).slice(0,10).forEach((e=>{const o=L.marker({lat:e.location.lat,lng:e.location.lng},{icon:Q});o.addTo(G).bindPopup((({author:e,offer:o})=>{const n=r.cloneNode(!0);n.querySelector(".popup__title").textContent=o.title,n.querySelector(".popup__text--address").textContent=o.address,n.querySelector(".popup__text--price").textContent=`${o.price} ₽/ночь`,n.querySelector(".popup__type").textContent=t[o.type],n.querySelector(".popup__text--capacity").textContent=`${o.rooms} комнаты для ${o.guests} гостей`,n.querySelector(".popup__text--time").textContent=`Заезд после ${o.checkin}, выезд до ${o.checkout}`,n.querySelector(".popup__description").textContent=o.description,n.querySelector(".popup__avatar"),n.querySelector("img").src=e.avatar;const a=n.querySelector(".popup__features");a.innerHTML=null,o.features.forEach((e=>{a.insertAdjacentHTML("beforeend",`<li class="popup__feature popup__feature--${e}"></li>`)}));const c=n.querySelector(".popup__photos");return c.innerHTML=null,o.photos.forEach((e=>{c.insertAdjacentHTML("beforeend",`<img src="${e}" class="popup__photo" width="45" height="40" alt="Фотография жилья">`)})),n})(e)),X.push(o)}))};fetch("https://22.javascript.pages.academy/keksobooking/data").then((e=>e.json())).catch(o).then((e=>{var t;Y(e),t=_.debounce((()=>{X.forEach((e=>G.removeLayer(e))),X=[],Y(e)}),500),a.addEventListener("change",(()=>t())),(e=>{P.addEventListener("click",(()=>e()))})((()=>Y(e)))}));const Z=()=>{G.setView(W,12),K.setLatLng(W),B()}})();
//# sourceMappingURL=main.bundle.js.map